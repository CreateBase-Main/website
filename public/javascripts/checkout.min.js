let numberOfPrints=0,numberOfDiscounts=0,checkout={balance:void 0,element:{heading:{cart:void 0,shipping:void 0,payment:void 0},button:{cart:void 0,shipping:void 0,payment:{bank:void 0,card:void 0}},windowSize:void 0},initialise:(void 0,async()=>{updateSessionPage();try{await global.initialise(!0,!1)}catch(e){return}removeLoader(!1),checkout.payment.stripe.initialise(),checkout.elements.assign(),checkout.load.load("loading order details");try{await checkout.load()}catch(e){return}checkout.listener(),checkout.load.success("loaded"),checkout.cart.resize()}),fetch:(void 0,()=>new Promise(async(e,t)=>{let c;try{c=(await axios.get("/checkout/fetch-order")).data}catch(e){c={status:"error",content:e}}return"error"===c.status||"failed"===c.status?t():e(c.content)})),insert:(void 0,e=>{const t=e.makes,c=e.order;checkout.cart.prints.insert(t);const o=c.manufacturingSpeed;let n;"normal"==o?document.querySelector("#checkout-normal-speed").checked=!0:"urgent"==o&&(document.querySelector("#checkout-urgent-speed").checked=!0),c.shipping.address.saved.suburb?n=checkout.shipping.address.saved.create(c.shipping.address.saved):(document.querySelector("#checkout-address-saved").disabled=!0,document.querySelector("#checkout-address-saved-label").classList.add("disabled"),document.querySelector("#checkout-address-saved-error").innerHTML="No Saved Address",document.querySelector("#checkout-address-saved-error").classList.remove("checkout-element-hide"),n="<p>No Saved Address</p>"),checkout.shipping.address.saved.insert(n),checkout.shipping.address.new.populate(c.shipping.address.new),document.querySelector("#checkout-shipping-save-address-input").checked=c.shipping.address.save,checkout.shipping.address.selected=c.shipping.address.option,"saved"===checkout.shipping.address.selected?c.shipping.address.saved.suburb&&(document.querySelector("#checkout-address-saved").checked=!0):"new"===checkout.shipping.address.selected&&(document.querySelector("#checkout-address-new").checked=!0),checkout.shipping.address.select(checkout.shipping.address.selected);const a=c.shipping.method;"pickup"==a?document.querySelector("#checkout-shipping-method-pickup").checked=!0:"tracked"==a?document.querySelector("#checkout-shipping-method-tracked").checked=!0:"courier"==a&&(document.querySelector("#checkout-shipping-method-courier").checked=!0),checkout.payment.method.selected=c.payment.method,checkout.payment.method.select(checkout.payment.method.selected)}),load:(void 0,async()=>{let e;try{e=await checkout.fetch()}catch(e){return}checkout.insert(e),checkout.amount.load(e.amount),checkout.balance=e.balance,checkout.payment.method.bank.detail(e.amount,e.wallet),checkout.cart.discounts.load(e.discounts),checkout.validate(e.validity)}),listener:(void 0,()=>{checkout.element.heading.cart.addEventListener("click",checkout.cart.show),checkout.element.windowSize.addListener(checkout.cart.prints.resize),checkout.element.windowSize.addListener(checkout.cart.resize),checkout.element.windowSize.addListener(checkout.shipping.resize),checkout.element.windowSize.addListener(checkout.payment.resize)}),validate:(void 0,async e=>{checkout.cart.validation.validate(e),checkout.shipping.validation.validate(e),checkout.payment.validation.validate(e)}),priceFormatter:(void 0,e=>{const t=Math.round(100*Number(e))/100,c=String(t),o=c.indexOf("."),n=c.length;let a;return-1===o?a=c+".00":n-o==2?a=c+"0":n-o==3&&(a=c),a}),paymentConfirmation:void 0,cancelConfirmation:void 0,elements:{assign:void 0},cart:{prints:{insert:void 0,resize:void 0},print:{create:void 0,insert:void 0,update:void 0,validate:{quantity:void 0},delete:void 0},discounts:{load:void 0},discount:{add:void 0,insert:void 0,validate:void 0},manufacturingSpeed:{select:void 0},validation:{validate:void 0,valid:void 0,invalid:void 0},show:void 0,resize:void 0,viewerFetch:void 0,viewerProcess:void 0},shipping:{address:{select:void 0,selected:void 0,saved:{create:void 0,insert:void 0,show:void 0},new:{update:void 0,populate:void 0,toggleSave:void 0,validate:{unit:void 0,street:{number:void 0,name:void 0},suburb:void 0,city:void 0,postcode:void 0,country:void 0,all:void 0},show:void 0}},method:{select:void 0},validation:{validate:void 0,valid:void 0,invalid:void 0},show:void 0,resize:void 0},payment:{stripe:{initialise:void 0,element:{stripe:void 0,elements:void 0,card:{number:void 0,expiry:void 0,cvc:void 0}},errorHandler:void 0},method:{select:void 0,selected:void 0,bank:{detail:void 0,show:void 0,paid:void 0},card:{paymentIntent:void 0,process:void 0,show:void 0,pay:void 0,error:void 0}},validation:{validate:void 0,valid:void 0,invalid:void 0},show:void 0},navigation:{navigate:void 0,changeCSS:{page:void 0}},load:{success:void 0,load:void 0,time:void 0},amount:{fetch:void 0,load:void 0}};checkout.elements.assign=()=>{checkout.element.heading.cart=document.querySelector("#checkout-cart-heading"),checkout.element.heading.shipping=document.querySelector("#checkout-shipping-heading"),checkout.element.heading.payment=document.querySelector("#checkout-payment-heading"),checkout.element.button.cart=document.querySelector("#checkout-cart-next"),checkout.element.button.shipping=document.querySelector("#checkout-shipping-next"),checkout.element.button.payment.bank=document.querySelector("#checkout-payment-bank-paid"),checkout.element.button.payment.card=document.querySelector("#checkout-payment-card-pay"),checkout.element.windowSize=window.matchMedia("(min-width: 850px)")},checkout.paymentConfirmation=(e="")=>{document.querySelector(`#checkout-confirm-${e}-payment`).classList.remove("hide")},checkout.cancelConfirmation=(e="")=>{document.querySelector(`#checkout-confirm-${e}-payment`).classList.add("hide")},checkout.amount.fetch=()=>new Promise(async(e,t)=>{let c;try{c=(await axios.get("/checkout/order-amount")).data}catch(e){return void t(e)}"failed"!==c.status?e(c.content):t(c.content)}),checkout.amount.load=async e=>{if(!e)try{e=await checkout.amount.fetch()}catch(e){return}let t,c,o,n,a,i,r;t="invalid"===e.makes.status?"-":"$ "+checkout.priceFormatter(e.makes.total),c="invalid"===e.manufacturing.status?"-":"$ "+checkout.priceFormatter(e.manufacturing.total),o="invalid"===e.discount.status?"-":"-$ "+checkout.priceFormatter(e.discount.total),n="invalid"===e.gst.status?"-":"$ "+checkout.priceFormatter(e.gst.total),a="invalid"===e.shipping.status?"-":"$ "+checkout.priceFormatter(e.shipping.total),i="invalid"===e.total.status?"-":"$ "+checkout.priceFormatter(e.total.total),r="invalid"===e.manufacturing.status?"-":"$ "+checkout.priceFormatter(e.makes.total+e.manufacturing.total-e.discount.total+e.gst.total),document.querySelector("#checkout-summary-value-subtotal").innerHTML=t,document.querySelector("#checkout-summary-value-manufacturing").innerHTML=c,document.querySelector("#checkout-summary-value-discount").innerHTML=o,document.querySelector("#checkout-summary-value-gst").innerHTML=n,document.querySelector("#checkout-summary-value-shipping").innerHTML=a,document.querySelector("#checkout-summary-total").innerHTML=i,document.querySelector("#checkout-cart-subtotal").innerHTML=t,document.querySelector("#checkout-cart-manufacturing").innerHTML=c,document.querySelector("#checkout-cart-discount").innerHTML=o,document.querySelector("#checkout-cart-gst").innerHTML=n,document.querySelector("#checkout-cart-total").innerHTML=r,document.querySelector("#checkout-shipping-subtotal").innerHTML=r,document.querySelector("#checkout-shipping-shipping-fee").innerHTML=a,document.querySelector("#checkout-shipping-total").innerHTML=i},checkout.cart.prints.insert=e=>{if(e){const t=e.awaitingQuote.concat(e.checkout);if(numberOfPrints=t.length,numberOfPrints){document.querySelector("#checkout-prints").innerHTML="";for(let e=0;e<numberOfPrints;e++)checkout.cart.print.insert(t[e])}else document.querySelector("#checkout-prints").innerHTML="<p>No 3D Prints</p>"}else numberOfPrints||(document.querySelector("#checkout-prints").innerHTML="<p>No 3D Prints</p>");checkout.cart.prints.resize(),checkout.cart.resize()},checkout.cart.prints.resize=()=>{checkout.element.windowSize.matches?document.querySelector("#checkout-prints").style=numberOfPrints?`height: ${10*numberOfPrints}vmax`:"height: 10vmax":document.querySelector("#checkout-prints").style=numberOfPrints?`height: ${16*numberOfPrints}vmax`:"height: 16vmax"},checkout.cart.print.create=e=>{const t=String(e._id),c=`<div class="checkout-print-container-1">${`<div id="checkout-viewer-${t}" class="viewer">\n    <div class="small-loading-icon">\n      <div class="layer layer-1"></div>\n      <div class="layer layer-2"></div>\n      <div class="layer layer-3"></div>\n    </div>\n  </div>`}</div>`,o=`<div class="checkout-print-container-2">${`<a href="/files/download/${e.file.id}">${e.file.name}</a>`+`<div class="build-type">${e.build}</div>`+`<div class="colour">${e.colour}</div>`+`<div class="checkout-print-quantity-container">\n                      <label>Quantity:</label>\n                      <input type="number" name="quantity" id="checkout-print-quantity-${t}" min="1" value="${e.quantity.ordered}"\n                        onchange="checkout.cart.print.update(this.value,'${e.quantity.ordered}', ['quantity', 'ordered'],'${t}');"/>\n                    </div>`}</div>`,n=`<div class="checkout-print-delete" onclick="checkout.cart.print.delete('${t}');"></div>`;let a;if("awaitingQuote"===e.status)a='<div class="price">awaiting quote</div>';else{a=`<div class="price">$ ${checkout.priceFormatter(e.price*e.quantity.ordered)}</div>`}return c+o+`<div class="checkout-print-container-3">${n+a}</div>`},checkout.cart.print.insert=(e,t)=>{const c=checkout.cart.print.create(e);if(t)t.innerHTML=c;else{const t=`<div class="print" id="checkout-print-${e._id}">${c}</div>`;document.querySelector("#checkout-prints").insertAdjacentHTML("beforeend",t)}const o="/files/stl/fetch/"+e.file.id,n="checkout-viewer-"+e._id;checkout.cart.viewerFetch(o,n)},checkout.cart.print.update=async(e,t,c,o)=>{if(!checkout.cart.print.validate.quantity(e,t,o))return;const n={property:c,value:e};let a;checkout.load.load("updating quantity");try{a=(await axios.post("/checkout/make/update",{makeId:o,updates:[n]})).data}catch(e){return}"failed"!==a.status&&(checkout.load.success("success"),checkout.amount.load(a.content),checkout.payment.method.bank.detail(a.content))},checkout.cart.print.validate.quantity=(e,t,c)=>!(e<=0)||(document.querySelector("#checkout-print-quantity-"+c).value=t,!1),checkout.cart.print.delete=async e=>{let t;document.querySelector("#checkout-print-"+e).remove(),numberOfPrints-=1,checkout.cart.prints.insert(),checkout.load.load("deleting 3D print");try{t=(await axios.post("/checkout/order/delete/print",{printId:e})).data}catch(e){return}return checkout.load.success("deleted"),checkout.validate(t.content)},checkout.cart.discounts.load=async(e=[])=>{for(let t=0;t<e.length;t++)checkout.cart.discount.insert(e[t]);return numberOfDiscounts=e.length},checkout.cart.discount.add=async()=>{const e=document.querySelector("#checkout-discount-input").value;let t,c={status:"",content:""};if(e||(c.status="failed",c.content="Input Discount Code"),checkout.cart.discount.validation(c)){try{t=(await axios.post("/checkout/discount/add",e)).data}catch(e){return}return checkout.cart.discount.validation(t)?checkout.cart.discount.insert(t.content):void 0}},checkout.cart.discount.insert=e=>{const t=`<div class="checkout-discount">${e.name} (${100*e.rate}% OFF)</div>`;document.querySelector("#checkout-discounts").insertAdjacentHTML("beforeend",t),document.querySelector("#checkout-discount-input").value="",document.querySelector("#checkout-discount-input-error").innerHTML=""},checkout.cart.discount.validation=e=>"failed"!==e.status||(document.querySelector("#checkout-discount-input-error").innerHTML=e.content,!1),checkout.cart.manufacturingSpeed.select=async e=>{const t={property:["manufacturingSpeed"],value:e};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}"failed"!==c.status&&(checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity))},checkout.cart.validation.validate=async e=>{let t;if(e)t=e.cart;else{let e;try{e=(await axios.get("/checkout/validate")).data}catch(e){return}if("failed"===e.status)return;t=e.content.cart}t?checkout.cart.validation.valid():checkout.cart.validation.invalid()},checkout.cart.validation.valid=()=>{checkout.element.heading.shipping.addEventListener("click",checkout.shipping.show),checkout.element.button.cart.removeAttribute("disabled"),checkout.element.heading.shipping.classList.add("valid")},checkout.cart.validation.invalid=()=>{checkout.element.heading.shipping.removeEventListener("click",checkout.shipping.show),checkout.element.button.cart.setAttribute("disabled",""),checkout.element.heading.shipping.classList.remove("valid"),checkout.cart.show()},checkout.cart.show=()=>{checkout.navigation.navigate(0)},checkout.cart.resize=()=>{const e=24+(numberOfPrints?10*numberOfPrints:10)+8+2*numberOfDiscounts+6+12+7;checkout.element.windowSize.matches?document.querySelector("#checkout-cart").style=0==checkoutSelectedPage?`height: ${e}vmax;`:"height: 6vmax;":document.querySelector("#checkout-cart").style="height: 100%;"},checkout.cart.viewerFetch=(e,t)=>{var c=document.getElementById(t),o=new THREE.PerspectiveCamera(70,c.clientWidth/c.clientHeight,1,1e3),n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});n.setSize(c.clientWidth,c.clientHeight),window.addEventListener("resize",(function(){n.setSize(c.clientWidth,c.clientHeight),o.aspect=c.clientWidth/c.clientHeight,o.updateProjectionMatrix()}),!1);var a=new THREE.Scene;a.add(new THREE.HemisphereLight(16777215,7895160,.8));(new THREE.STLLoader).load(e,e=>{c.innerHTML="",c.appendChild(n.domElement),checkout.cart.viewerProcess(o,n,a,e)})},checkout.cart.viewerProcess=(e,t,c,o)=>{var n=new THREE.MeshPhongMaterial({color:15790320,specular:16316664,shininess:0,reflectivity:0}),a=new THREE.Mesh(o,n);c.add(a);var i=new THREE.Vector3;o.computeBoundingBox(),o.boundingBox.getCenter(i),a.geometry.applyMatrix4((new THREE.Matrix4).makeTranslation(-i.x,-i.y,-i.z)),a.geometry.rotateY(-Math.PI/5);var r=Math.max(o.boundingBox.max.x,o.boundingBox.max.y,o.boundingBox.max.z);e.position.z=2.5*r;var u=function(){requestAnimationFrame(u),t.render(c,e)};u()},checkout.shipping.address.select=async(e,t)=>{if(checkout.shipping.address.selected=e,"saved"==e?(checkout.shipping.address.saved.show(!0),checkout.shipping.address.new.show(!1)):"new"==e&&(checkout.shipping.address.saved.show(!1),checkout.shipping.address.new.show(!0)),checkout.shipping.resize(),t){const t={property:["shipping","address","option"],value:e};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}if("failed"===c.status)return;checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity)}},checkout.shipping.address.saved.create=e=>{let t="";e.unit&&(t=`<div>${e.unit}</div>`);return t+`<div>${e.street.number} ${e.street.name}</div>`+`<div>${e.suburb}</div>`+`<div>${e.city}, ${e.postcode}</div>`+`<div>${e.country}</div>`},checkout.shipping.address.saved.insert=e=>{document.querySelector("#checkout-saved-address").innerHTML=e},checkout.shipping.address.saved.show=e=>{e?document.querySelector("#checkout-saved-address").classList.remove("checkout-element-hide"):document.querySelector("#checkout-saved-address").classList.add("checkout-element-hide")},checkout.shipping.address.new.validate.unit=()=>({valid:!0,input:document.querySelector("#checkout-new-address-unit").value,message:""}),checkout.shipping.address.new.validate.street.number=()=>{const e=document.querySelector("#checkout-new-address-street-number").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.street.name=()=>{const e=document.querySelector("#checkout-new-address-street-name").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.suburb=()=>{const e=document.querySelector("#checkout-new-address-suburb").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.city=()=>{const e=document.querySelector("#checkout-new-address-city").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.postcode=()=>{const e=document.querySelector("#checkout-new-address-postcode").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.country=()=>{const e=document.querySelector("#checkout-new-address-country").value;let t={valid:!0,input:e,message:""};return e||(t.valid=!1,t.message="requires input"),t},checkout.shipping.address.new.validate.all=e=>{const t=checkout.shipping.address.new.validate.unit(),c=checkout.shipping.address.new.validate.street.number(),o=checkout.shipping.address.new.validate.street.name(),n=checkout.shipping.address.new.validate.suburb(),a=checkout.shipping.address.new.validate.city(),i=checkout.shipping.address.new.validate.postcode(),r=checkout.shipping.address.new.validate.country();t.valid&&c.valid&&o.valid&&n.valid&&a.valid&&i.valid&&r.valid;"unit"==e?document.querySelector("#checkout-shipping-unit-error").innerHTML=t.message:"streetNumber"==e?document.querySelector("#checkout-shipping-street-number-error").innerHTML=c.message:"streetName"==e?document.querySelector("#checkout-shipping-street-name-error").innerHTML=o.message:"suburb"==e?document.querySelector("#checkout-shipping-suburb-error").innerHTML=n.message:"city"==e?document.querySelector("#checkout-shipping-city-error").innerHTML=a.message:"postcode"==e?document.querySelector("#checkout-shipping-postcode-error").innerHTML=i.message:("country"==e||(document.querySelector("#checkout-shipping-unit-error").innerHTML=t.message,document.querySelector("#checkout-shipping-street-number-error").innerHTML=c.message,document.querySelector("#checkout-shipping-street-name-error").innerHTML=o.message,document.querySelector("#checkout-shipping-suburb-error").innerHTML=n.message,document.querySelector("#checkout-shipping-city-error").innerHTML=a.message,document.querySelector("#checkout-shipping-postcode-error").innerHTML=i.message),document.querySelector("#checkout-shipping-country-error").innerHTML=r.message);return{unit:t.input,street:{number:c.input,name:o.input},suburb:n.input,city:a.input,postcode:i.input,country:r.input}},checkout.shipping.address.new.populate=e=>{document.querySelector("#checkout-new-address-unit").value=e.unit,document.querySelector("#checkout-new-address-street-number").value=e.street.number,document.querySelector("#checkout-new-address-street-name").value=e.street.name,document.querySelector("#checkout-new-address-suburb").value=e.suburb,document.querySelector("#checkout-new-address-city").value=e.city,document.querySelector("#checkout-new-address-postcode").value=e.postcode,document.querySelector("#checkout-new-address-country").value=e.country},checkout.shipping.address.new.update=async e=>{const t={property:["shipping","address","new"],value:checkout.shipping.address.new.validate.all(e)};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}"failed"!==c.status&&(checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity))},checkout.shipping.address.new.toggleSave=async e=>{const t={property:["shipping","address","save"],value:e};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}"failed"!==c.status&&(checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity))},checkout.shipping.address.new.show=e=>{e?document.querySelector("#checkout-new-address").classList.remove("checkout-element-hide"):document.querySelector("#checkout-new-address").classList.add("checkout-element-hide")},checkout.shipping.method.select=async e=>{const t={property:["shipping","method"],value:e};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}"failed"!==c.status&&(checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity))},checkout.shipping.validation.validate=async e=>{let t;if(e)t=e.cart&&e.shipping;else{let e;try{e=(await axios.get("/checkout/validate")).data}catch(e){return}if("failed"===e.status)return;t=e.content.cart&&e.content.shipping}t?checkout.shipping.validation.valid():checkout.shipping.validation.invalid()},checkout.shipping.validation.valid=()=>{checkout.element.heading.payment.addEventListener("click",checkout.payment.show),checkout.element.button.shipping.removeAttribute("disabled"),checkout.element.heading.payment.classList.add("valid")},checkout.shipping.validation.invalid=()=>{checkout.element.heading.payment.removeEventListener("click",checkout.payment.show),checkout.element.button.shipping.setAttribute("disabled",""),checkout.element.heading.payment.classList.remove("valid")},checkout.shipping.show=()=>{checkout.navigation.navigate(1)},checkout.shipping.resize=()=>{let e={saved:2,new:0};"saved"===checkout.shipping.address.selected?e.saved=9:"new"===checkout.shipping.address.selected&&(e.new=16.5);const t=33+e.saved+e.new+5+12;let c=0;"new"===checkout.shipping.address.selected&&(c=140);let o="height: 100%;";checkout.element.windowSize.matches&&(o=1==checkoutSelectedPage?`height: calc(${c}px + ${t}vmax);`:"height: 6vmax;"),document.querySelector("#checkout-shipping").style=o},checkout.payment.stripe.initialise=()=>{checkout.payment.stripe.element.stripe=Stripe("pk_test_cyWnxjuNQGbF42g88sLseXpJ003JGn4TCC"),checkout.payment.stripe.element.elements=checkout.payment.stripe.element.stripe.elements(),checkout.payment.stripe.element.card.number=checkout.payment.stripe.element.elements.create("cardNumber"),checkout.payment.stripe.element.card.number.mount("#checkout-card-num"),checkout.payment.stripe.element.card.expiry=checkout.payment.stripe.element.elements.create("cardExpiry"),checkout.payment.stripe.element.card.expiry.mount("#checkout-card-exp"),checkout.payment.stripe.element.card.cvc=checkout.payment.stripe.element.elements.create("cardCvc"),checkout.payment.stripe.element.card.cvc.mount("#checkout-card-cvc"),checkout.payment.stripe.errorHandler()},checkout.payment.stripe.errorHandler=()=>{checkout.payment.stripe.element.card.number.addEventListener("change",({error:e})=>{const t=document.querySelector("#checkout-card-number-error");t.textContent=e?"invalid":""}),checkout.payment.stripe.element.card.expiry.addEventListener("change",({error:e})=>{const t=document.querySelector("#checkout-card-expiry-error");t.textContent=e?"invalid":""}),checkout.payment.stripe.element.card.cvc.addEventListener("change",({error:e})=>{const t=document.querySelector("#checkout-card-cvc-error");t.textContent=e?"invalid":""})},checkout.payment.method.select=async(e,t)=>{if(checkout.payment.method.selected=e,"bankTransfer"===e?(document.querySelector("#checkout-payment-method-bank").checked=!0,checkout.payment.method.bank.show(!0),checkout.payment.method.card.show(!1)):"card"===e&&(document.querySelector("#checkout-payment-method-card").checked=!0,checkout.payment.method.bank.show(!1),checkout.payment.method.card.show(!0)),checkout.payment.resize(),t){const t={property:["payment","method"],value:e};let c;checkout.load.load("updating order");try{c=(await axios.post("/checkout/update",{updates:[t]})).data}catch(e){return}if("failed"===c.status)return;checkout.load.success("saved"),checkout.amount.load(c.content.amount),checkout.payment.method.bank.detail(c.content.amount),checkout.validate(c.content.validity)}},checkout.payment.method.bank.detail=(e,t)=>{let c=priceNormaliser(checkout.balance.bankTransfer+checkout.balance.bankTransferBonus+checkout.balance.onlinePayment-checkout.balance.checkout),o="$"+c;if(c<0&&(o="-$"+Math.abs(c)),document.querySelector("#checkout-account-balance").innerHTML=o,e){const t=priceNormaliser(e.total.total-c);let o=0,n=0,a=!0;for(t<=0&&(a=!1);a;){const e=priceNormaliser(o+n),c=priceNormaliser(t-e);c>20?(o=priceNormaliser(o+20),n=priceNormaliser(n+1)):c<=20&&(o=priceNormaliser(o+c),a=!1)}document.querySelector("#checkout-bank-transfer-amount").innerHTML="$"+o}t&&(document.querySelector("#checkout-bank-transfer-reference").innerHTML=t.code)},checkout.payment.method.bank.show=e=>{e?document.querySelector("#checkout-payment-bank-container").classList.remove("checkout-element-hide"):document.querySelector("#checkout-payment-bank-container").classList.add("checkout-element-hide")},checkout.payment.method.bank.paid=async()=>{let e;checkout.element.button.payment.bank.setAttribute("disabled",""),showLoader(!1),document.querySelector(".full-page-loading-text").innerHTML="Processing checkout...";try{e=(await axios.get("/checkout/bank-transfer")).data}catch(t){e={status:"error",content:t}}"error"!==e.status?"failed"!==e.status&&(document.querySelector(".full-page-loading-text").innerHTML="Your checkout has been processed successfully!",setTimeout(()=>{document.querySelector(".full-page-loading-text").innerHTML="Redirecting to your orders page...",setTimeout(()=>window.location.href="/profile/orders",1e3)},1e3)):document.querySelector(".full-page-loading-text").innerHTML="An error has been encountered, refresh the page and try again"},checkout.payment.method.card.pay=async()=>{let e;checkout.element.button.payment.card.setAttribute("disabled",""),showLoader(!1),document.querySelector(".full-page-loading-text").innerHTML="Processing payment...";try{e=(await axios.get("/checkout/payment-intent")).data}catch(t){e={status:"error",content:t}}if("error"===e.status)return void(document.querySelector(".full-page-loading-text").innerHTML="An error has been encountered, refresh the page and try again");if("failed"===e.status)return;const t=e.content;let c;document.querySelector(".full-page-loading-text").innerHTML="Validating payment...";try{c=await checkout.payment.method.card.process(t)}catch(e){return checkout.payment.method.card.error(e)}document.querySelector(".full-page-loading-text").innerHTML="Your payment has been successful. Processing checkout...";const o=c.id;let n;try{n=(await axios.post("/checkout/card-payment",{paymentIntentId:o})).data}catch(e){n={status:"error",content:e}}"error"!==n.status?"failed"!==n.status&&(document.querySelector(".full-page-loading-text").innerHTML="Your checkout has been processed successfully!",setTimeout(()=>{document.querySelector(".full-page-loading-text").innerHTML="Redirecting to your orders page...",setTimeout(()=>window.location.href="/profile/orders",1e3)},1e3)):document.querySelector(".full-page-loading-text").innerHTML="An error has been encountered, refresh the page and try again"},checkout.payment.method.card.process=(e,t)=>new Promise(async(t,c)=>{const o={payment_method:{card:checkout.payment.stripe.element.card.number}};let n;try{n=await checkout.payment.stripe.element.stripe.confirmCardPayment(e,o)}catch(e){return c({status:"error",content:e})}return n.error?c({status:"failed",content:n.error.message}):t(n.paymentIntent)}),checkout.payment.method.card.error=e=>{"error"===e.status?document.querySelector(".full-page-loading-text").innerHTML="Error! Please refresh the page and try again.":"failed"===e.status&&(document.querySelector("#checkout-card-error").innerHTML=e.content,checkout.element.button.payment.card.removeAttribute("disabled"),removeLoader(!1))},checkout.payment.method.card.show=e=>{e?document.querySelector("#checkout-payment-card-container").classList.remove("checkout-element-hide"):document.querySelector("#checkout-payment-card-container").classList.add("checkout-element-hide")},checkout.payment.validation.validate=async e=>{let t;if(e)t=e.cart&&e.shipping&&e.payment;else{let e;try{e=(await axios.get("/checkout/validate")).data}catch(e){return}if("failed"===e.status)return;t=e.content.cart&&e.content.shipping&&e.content.payment}t?checkout.payment.validation.valid():checkout.payment.validation.invalid()},checkout.payment.validation.valid=()=>{checkout.element.button.payment.bank.removeAttribute("disabled"),checkout.element.button.payment.card.removeAttribute("disabled")},checkout.payment.validation.invalid=()=>{checkout.element.button.payment.bank.setAttribute("disabled",""),checkout.element.button.payment.card.setAttribute("disabled","")},checkout.payment.show=()=>{checkout.navigation.navigate(2)},checkout.payment.resize=()=>{let e=0,t=0;"bankTransfer"==checkout.payment.method.selected?(e=12,t=26.5):"card"==checkout.payment.method.selected&&(e=12,t=7.5);const c=8+e+t+2+6;checkout.element.windowSize.matches?document.querySelector("#checkout-payment").style=2===checkoutSelectedPage?`height: ${c}vmax;`:"height: 6vmax;":document.querySelector("#checkout-payment").style="height: 100%;"};let checkoutPages=["cart","shipping","payment","complete"],checkoutSelectedPage=0;checkout.navigation.navigate=e=>{e!=checkoutSelectedPage&&(checkout.navigation.changeCSS.page(e),checkoutSelectedPage=e,checkout.cart.resize(),checkout.shipping.resize(),checkout.payment.resize())},checkout.navigation.changeCSS.page=e=>{const t=checkoutPages[e];if(e>checkoutSelectedPage){document.querySelector("#checkout-"+t).classList.remove("right");for(let t=checkoutSelectedPage;t<e;t++){const e=checkoutPages[t];document.querySelector("#checkout-"+e).classList.remove("right"),document.querySelector("#checkout-"+e).classList.add("left")}}else{document.querySelector("#checkout-"+t).classList.remove("left");for(let t=checkoutSelectedPage;t>e;t--){const e=checkoutPages[t];document.querySelector("#checkout-"+e).classList.remove("left"),document.querySelector("#checkout-"+e).classList.add("right")}}},checkout.load.success=e=>{clearTimeout(checkout.load.time),document.querySelector("#checkout-loading-display-load").innerHTML='<svg class="checkmark" viewBox="0 0 52 52">\n  <circle\n    class="checkmark__circle"\n    cx="26"\n    cy="26"\n    r="25"\n    fill="none"\n  ></circle>\n  <path\n    class="checkmark__check"\n    fill="none"\n    d="M14.1 27.2l7.1 7.2 16.7-16.8"\n  ></path>\n</svg>',document.querySelector("#checkout-loading-display-text").innerHTML=e,checkout.load.time=setTimeout(()=>{document.querySelector("#checkout-loading-display").classList.add("hide")},1300)},checkout.load.load=e=>{document.querySelector("#checkout-loading-display-load").innerHTML='<div class="load-2">\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                  </div>',document.querySelector("#checkout-loading-display-text").innerHTML=e,document.querySelector("#checkout-loading-display").classList.remove("hide")};